# Cyber Engine 项目文档

## 项目概述

Cyber Engine 是一个基于 WebSocket 协议的智能对话引擎系统，通过结合大语言模型与知识库系统，提供指令执行和问答功能。系统可以自动识别用户输入类型，并将其路由到相应的处理流程。

## 系统架构

### 核心组件

1. **WebSocket 服务**：提供实时通信接口，处理客户端连接和消息传递
2. **引擎核心 (Engine Core)**：处理用户输入并生成响应
   - 路由代理：自动判断输入类型（问题/指令）
   - 指令执行器：处理功能性指令请求
   - 知识库查询：处理问答类请求
3. **插件系统**：通过工具扩展系统功能
4. **消息队列**：管理用户消息历史和状态
5. **任务中心**：管理和执行长时间运行的任务

### 技术栈

- **后端**：Python, FastAPI, Uvicorn
- **大语言模型**：支持 OpenAI API 兼容的模型
- **嵌入与检索**：支持多种嵌入方法（OpenAI, Ollama, Sentence Transformers）
- **数据存储**：SQLite, LanceDB

## 主要功能

1. **智能路由**：自动区分用户输入的问题和指令，并路由到合适的处理流程
2. **知识库问答**：查询知识库，返回相关信息和答案
3. **指令执行**：处理特定格式的指令，执行预定义的功能
4. **命令系统**：以 "/" 开头的特殊命令，提供系统控制和信息查询功能
5. **任务管理**：支持长时间任务的创建、查询和管理

## 配置说明

系统通过 `.env` 文件配置，主要配置项包括：

- 服务器设置：主机、端口
- 大语言模型设置：API密钥、模型名称、基础URL、代理设置
- 嵌入设置：嵌入方法、模型
- 知识库设置：基础URL、API密钥、数据集ID
- 邮件设置：SMTP主机、发件人、验证码

## 部署指南

### 环境要求

- Python 3.10+
- 依赖库参见 `requirements.txt`

### 安装步骤

1. 克隆仓库
   ```bash
   git clone https://github.com/your-username/cyber_engine.git
   cd cyber_engine
   ```

2. 安装依赖
   ```bash
   pip install -r requirements.txt
   ```

3. 配置环境
   - 复制 `.env.example` 到 `.env`
   - 根据需要修改配置参数

4. 启动服务
   ```bash
   python start_main_server.py
   ```

## 客户端接入

系统使用WebSocket协议进行通信，客户端需要按照以下格式发送消息：

```json
{
  "content": "用户消息内容",
  "model": "模型名称"
}
```

系统将以流式方式返回处理结果。

## 扩展接入方式

可以通过以下客户端项目扩展系统的接入方式：

1. **cyber-qbot**：将服务接入到QQ机器人
2. **cyber-openai**：以OpenAI API格式向外提供服务，便于与现有生态集成

## 故障排除

- 检查日志文件 `logs/runtime.log`
- 确认配置文件中的API密钥和URL是否正确
- 确认知识库服务是否正常运行

## 开发指南

### 添加新工具

1. 在 `engine_core/plugins` 目录下创建新工具
2. 在工具代码中实现所需功能
3. 将工具注册到工具系统中

### 自定义命令

在 `engine_core/command.py` 中添加新命令处理函数，并注册到命令系统。 